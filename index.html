<!DOCTYPE html>
<html lang="en">

<head>
    <title>FRC Scouting Application</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            background-color: white;
            color: black;
        }

        h3 {
            display: inline;
        }

        /* STYLE BUTTON */
        button {
            margin-top: 5px;
        }

        .increment {
            height: 50px;
            width: 200px;
        }

        .decrement {
            height: 30px;
            width: 10px;
        }

        .dark_mode {
            background-color: black;
            color: lightgray;
        }
    </style>

</head>

<body>

    <header>
        <h1>FRC Scouting Application</h1>
        <button id="dark_mode">Toggle Dark Mode</button>
    </header>

    <main>
        <div class="match_info">
            <label for="scout_name">Scout Name: </label>
            <input type="text" id="scout_name" name="scoutName">
            <label for="team_number">Team Number:</label>
            <input type="number" id="team_number" name="teamNumber">
            <label for="match_number">Match Number:</label>
            <input type="number" id="match_number" name="matchNumber">
            <label for="alliance_color">Alliance Color:</label>
            <select id="alliance_color">
                <option value="red">Red</option>
                <option value="blue">Blue</option>
            </select>
        </div> <br>

        <div class="start_info">
            <label for="robot_present">Robot Present in Match:</label>
            <select id="robot_present">
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
            <label for="exited_tarmac">Exited Tarmac:</label>
            <select id="exited_tarmac">
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
        </div><br>

        <div class="map">
            <p>Select the balls that the robot picks up during auton. </p>
            <img id="fieldMap" src="assets/GameFieldZoned.png" usemap="#fieldmap">
            <map name="fieldmap">
                <area id="zone14" shape="circle" coords="209, 262, 16" onclick="zone14click()" />
                <area id="zone13" shape="circle" coords="311, 326, 16" onclick="zone13click()" />
                <area id="zone12" shape="circle" coords="372, 322, 16" onclick="zone12click()" />
                <area id="zone11" shape="circle" coords="427, 299, 16" onclick="zone11click()" />
                <area id="zone10" shape="circle" coords="471, 253, 16" onclick="zone10click()" />
                <area id="zone9" shape="circle" coords="491, 134, 16" onclick="zone9click()" />
                <area id="zone8" shape="circle" coords="627, 50, 16" onclick="zone8click()" />
                <area id="zone7" shape="circle" coords="465, 78, 16" onclick="zone7click()" />
                <area id="zone6" shape="circle" coords="364, 15, 16" onclick="zone6click()" />
                <area id="zone5" shape="circle" coords="304, 18, 16" onclick="zone5click()" />
                <area id="zone4" shape="circle" coords="246, 39, 16" onclick="zone4click()" />
                <area id="zone3" shape="circle" coords="205, 88, 16" onclick="zone3click()" />
                <area id="zone2" shape="circle" coords="185, 205, 16" onclick="zone2click()" />
                <area id="zone1" shape="circle" coords="45, 291, 16" onclick="zone1click()" />
            </map>
            <p id="zone_display">Balls Selected:</p>
        </div>
        <div class="auton">
            <h2>Autonomous Period</h2>
            <div class="point_buttons">
                <div>
                    <h3>High Goal</h3>
                    <button class="decrement" id="decrement_auton_high" onclick="dec_auton_high()">-</button>
                    <button type="button" class="increment" id="increment_auton_high" onclick="inc_auton_high()">Add
                        Point</button>
                    <h3 id="auton_high">0</h3>
                </div>
                <div>
                    <h3>Low Goal</h3>
                    <button class="decrement" id="decrement_auton_low" onclick="dec_auton_low()">-</button>
                    <button class="increment" id="increment_auton_low" onclick="inc_auton_low()">Add Point</button>
                    <h3 id="auton_low">0</h3><br>
                </div>
            </div>
        </div> <br>

        <div class="teleop">
            <h2>Teleoperated Period</h2>
            <div class="point_buttons">
                <div>
                    <h3>High Goal</h3>
                    <button class="decrement" id="decrement_teleop_high" onclick="dec_teleop_high()">-</button>
                    <button class="increment" id="increment_teleop_high" onclick="inc_teleop_high()">Add Point</button>
                    <h3 id="teleop_high">0</h3>
                </div>
                <div>
                    <h3>Low Goal</h3>
                    <button class="decrement" id="decrement_teleop_low" onclick="dec_teleop_low()">-</button>
                    <button class="increment" id="increment_teleop_low" onclick="inc_teleop_low()">Add Point</button>
                    <h3 id="teleop_low">0</h3><br>
                </div>
            </div>
        </div> <br>

        <div class="opposing">
            <h2>Opposing Cargo Scored</h2>
            <div class="point_buttons">
                <div>
                    <h3>High Goal</h3>
                    <button class="decrement" id="decrement_opposing_high" onclick="dec_opposing_high()">-</button>
                    <button class="increment" id="increment_opposing_high" onclick="inc_opposing_high()">Add
                        Point</button>
                    <h3 id="opposing_high">0</h3>
                </div>
                <div>
                    <h3>Low Goal</h3>
                    <button class="decrement" id="decrement_opposing_low" onclick="dec_opposing_low()">-</button>
                    <button class="increment" id="increment_opposing_low" onclick="inc_opposing_low()">Add
                        Point</button>
                    <h3 id="opposing_low">0</h3><br>
                </div>
            </div>
        </div> <br>

        <div class="other">
            <h2>Scoring Position <button id="reset_score_pos" onclick="resetScorePos()">Reset</button></h2>
            <div class="score_position_buttons">
                <button id="tarmac" onclick="tarmac_shoot()">Tarmac</button>
                <button id="launchpad" onclick="launchpad_shoot()">Launch Pad</button>
                <button id="other" onclick="other_shoot()">Other</button>
            </div>

            <h2>Climb Level <button id="reset_climb" onclick="resetClimb()">Reset</button></h2>
            <div class="climb_buttons">
                <button id="none" onclick="no_climb()">None</button>
                <button id="attempted" onclick="attempted_climb()">Attempted</button>
                <button id="low" onclick="low_climb()">Low</button>
                <button id="middle" onclick="mid_climb()">Middle</button>
                <button id="high" onclick="high_climb()">High</button>
                <button id="traversal" onclick="traversal_climb()">Traversal</button>
            </div>
        </div> <br>

        <div class="flags">
            <h2>Fouls and Flags <button id="reset_flags" onclick="resetFlags()">Reset</button></h2>
            <button id="foul" onclick="fouled()">Foul</button>
            <button id="tech_foul" onclick="tech_fouled()">Tech Foul</button>
            <button id="yellow" onclick="yellow_carded()">Yellow Card</button>
            <button id="red" onclick="red_carded()">Red Card</button><br>
            <button id="crashing" onclick="crashes()">Uncontrolled Crashing</button>
            <!-- <button id="opposing">Scored Opposing Cargo</button> -->
            <button id="drivetrain" onclick="drivetrain_broke()">Broken Drivetrain</button>
            <button id="defense" onclick="playing_defense()">Played Defense</button>
        </div> <br>

        <div>
            <button id="generate_qr" onclick="gather()">Generate QR Code</button>
            <button id="clear">Clear</button>
            <button id="copy">Copy</button>
            <div id="display"></div>
        </div>
    </main>

    <script defer src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>

    <script>

        var data = "";

        var scoutName = document.getElementById("scout_name");
        var teamNumber = document.getElementById("team_number");
        var matchNumber = document.getElementById("match_number");
        var allianceColor = document.getElementById("alliance_color");
        var robotPresent = document.getElementById("robot_present");
        var exitedTarmac = document.getElementById("exited_tarmac");

        var autonHigh = document.getElementById("auton_high");
        var autonLow = document.getElementById("auton_low");
        var teleopHigh = document.getElementById("teleop_high");
        var teleopLow = document.getElementById("teleop_low");
        var opposingHigh = document.getElementById("opposing_high");
        var opposingLow = document.getElementById("opposing_low");

        var auton_high_scored = 0;
        var auton_low_scored = 0;
        var teleop_high_scored = 0;
        var teleop_low_scored = 0;
        var opposing_high_scored = 0;
        var opposing_low_scored = 0;

        //scoring position
        var tarmac = document.getElementById("tarmac");
        var launch_pad = document.getElementById("launchpad");
        var other = document.getElementById("other");

        //climb level
        var none = document.getElementById("none");
        var attempted = document.getElementById("attempted");
        var low = document.getElementById("low");
        var middle = document.getElementById("middle");
        var high = document.getElementById("high");
        var traversal = document.getElementById("traversal");

        //fouls
        var foul_object = document.getElementById("foul");
        var tech_foul_object = document.getElementById("tech_foul");
        var yellow_object = document.getElementById("yellow");
        var red_object = document.getElementById("red");

        //flags
        var crashing_object = document.getElementById("crashing");
        var drivetrain_object = document.getElementById("drivetrain");
        var defense_object = document.getElementById("defense");

        document.getElementById("dark_mode").addEventListener("click", function () {
            var element = document.body;
            element.classList.toggle("dark_mode");
        });

        function inc_auton_high() { auton_high_scored++; document.getElementById("auton_high").innerHTML = auton_high_scored; };
        function dec_auton_high() { if (auton_high_scored > 0) { auton_high_scored--; document.getElementById("auton_high").innerHTML = auton_high_scored; } };

        function inc_auton_low() { auton_low_scored++; autonLow.innerHTML = auton_low_scored; };
        function dec_auton_low() { if (auton_low_scored > 0) { auton_low_scored--; autonLow.innerHTML = auton_low_scored; } };

        function inc_teleop_high() { teleop_high_scored++; teleopHigh.innerHTML = teleop_high_scored; };
        function dec_teleop_high() { if (teleop_high_scored > 0) { teleop_high_scored--; teleopHigh.innerHTML = teleop_high_scored; } };

        function inc_teleop_low() { teleop_low_scored++; teleopLow.innerHTML = teleop_low_scored; };
        function dec_teleop_low() { if (teleop_low_scored > 0) { teleop_low_scored--; teleopLow.innerHTML = teleop_low_scored; } };

        function inc_opposing_high() { opposing_high_scored++; opposingHigh.innerHTML = opposing_high_scored; };
        function dec_opposing_high() { if (opposing_high_scored > 0) { opposing_high_scored--; opposingHigh.innerHTML = opposing_high_scored; } };

        function inc_opposing_low() { opposing_low_scored++; opposingLow.innerHTML = opposing_low_scored; };
        function dec_opposing_low() { if (opposing_low_scored > 0) { opposing_low_scored--; opposingLow.innerHTML = opposing_low_scored; } };

        function tarmac_shoot() { tarmac.disabled = true; };
        function launchpad_shoot() { launchpad.disabled = true; };
        function other_shoot() { other.disabled = true; };

        function resetScorePos() {
            tarmac.disabled = false;
            launchpad.disabled = false;
            other.disabled = false;
        }

        function no_climb() { none.disabled = true; };
        function attempted_climb() { attempted.disabled = true; };
        function low_climb() { low.disabled = true; };
        function mid_climb() { middle.disabled = true; };
        function high_climb() { high.disabled = true; };
        function traversal_climb() { traversal.disabled = true; };

        function resetClimb() {
            none.disabled = false;
            attempted.disabled = false;
            low.disabled = false;
            middle.disabled = false;
            high.disabled = false;
            traversal.disabled = false;
        }

        function fouled() { foul_object.disabled = true; };
        function tech_fouled() { tech_foul_object.disabled = true; };
        function yellow_carded() { yellow_object.disabled = true; };
        function red_carded() { red_object.disabled = true; };

        function crashes() { crashing_object.disabled = true; };
        function drivetrain_broke() { drivetrain_object.disabled = true; };
        function playing_defense() { defense_object.disabled = true; };

        function resetFlags() {
            foul_object.disabled = false;
            tech_foul_object.disabled = false;
            yellow_object.disabled = false;
            red_object.disabled = false;
            crashing_object.disabled = false;
            drivetrain_object.disabled = false;
            defense_object.disabled = false;
        }

        var startZone = "";
        var b1, b2, b3, b4, b5, b6, b7, b8, b9, b10, b11, b12, b13, b14 = false;
        function zone1click() {
            startZone = "Zone1"; b1 = !b1;
            if (b1) {
                document.getElementById("zone_display").innerHTML += " Ball 1,";
            } else { removeZone(" Ball 1,"); }
        };
        function zone2click() {
            startZone = "Zone2"; b2 = !b2;
            if (b2) {
                document.getElementById("zone_display").innerHTML += " Ball 2,";
            } else { removeZone(" Ball 2,"); }
        };
        function zone3click() {
            startZone = "Zone3"; b3 = !b3;
            if (b3) {
                document.getElementById("zone_display").innerHTML += " Ball 3,";
            } else { removeZone(" Ball 3,"); }
        };
        function zone4click() {
            startZone = "Zone4"; b4 = !b4;
            if (b4) {
                document.getElementById("zone_display").innerHTML += " Ball 4,";
            } else { removeZone(" Ball 4,"); }
        };
        function zone5click() {
            startZone = "Zone5"; b5 = !b5;
            if (b5) {
                document.getElementById("zone_display").innerHTML += " Ball 5,";
            } else { removeZone(" Ball 5,"); }
        };
        function zone6click() {
            startZone = "Zone6"; b6 = !b6;
            if (b6) {
                document.getElementById("zone_display").innerHTML += " Ball 6,";
            } else { removeZone(" Ball 6,"); }
        };
        function zone7click() {
            startZone = "Zone7"; b7 = !b7;
            if (b7) {
                document.getElementById("zone_display").innerHTML += " Ball 7,";
            } else { removeZone(" Ball 7,"); }
        };
        function zone8click() {
            startZone = "Zone8"; b8 = !b8;
            if (b8) {
                document.getElementById("zone_display").innerHTML += " Ball 8,";
            } else { removeZone(" Ball 8,"); }
        };
        function zone9click() {
            startZone = "Zone9"; b9 = !b9;
            if (b9) {
                document.getElementById("zone_display").innerHTML += " Ball 9,";
            } else { removeZone(" Ball 9,"); }
        };
        function zone10click() {
            startZone = "Zone10"; b10 = !b10;
            if (b10) {
                document.getElementById("zone_display").innerHTML += " Ball 10,";
            } else { removeZone(" Ball 10,"); }
        };
        function zone11click() {
            startZone = "Zone11"; b11 = !b11;
            if (b11) {
                document.getElementById("zone_display").innerHTML += " Ball 11,";
            } else { removeZone(" Ball 11,"); }
        };
        function zone12click() {
            startZone = "Zone12"; b12 = !b12;
            if (b12) {
                document.getElementById("zone_display").innerHTML += " Ball 12,";
            } else { removeZone(" Ball 12,"); }
        };
        function zone13click() {
            startZone = "Zone13"; b13 = !b13;
            if (b13) {
                document.getElementById("zone_display").innerHTML += " Ball 13,";
            } else { removeZone(" Ball 13,"); }
        };
        function zone14click() {
            startZone = "Zone14"; b14 = !b14;
            if (b14) {
                document.getElementById("zone_display").innerHTML += " Ball 14,";
            } else { removeZone(" Ball 14,"); }
        };


        document.getElementById("clear").addEventListener("click", function () {
            //console.log(":)");
            teamNumber.value = 0;
            var nextMatch = parseInt(matchNumber.value);
            matchNumber.value = nextMatch;
            robotPresent.value = "";
            exitedTarmac.value = "";
            document.getElementById("zone_display").innerHTML = "Balls Selected: ";
            autonHigh.innerHTML = "0";
            auton_high_scored = 0;
            autonLow.innerHTML = "0";
            auton_low_scored = 0;
            teleopHigh.innerHTML = "0";
            teleop_high_scored = 0;
            teleopLow.innerHTML = "0";
            teleop_low_scored = 0;
            opposing_high_scored = 0;
            opposingHigh.innerHTML = "0";
            opposing_low_scored = 0;
            opposingLow.innerHTML = "0";
            resetScorePos();
            resetClimb();
            resetFlags();
            document.getElementById("display").innerHTML = "";
            data = "";
        });

        function gather() {
            data = "";
            data += scoutName.value + "."; //string
            data += teamNumber.value + "."; //number
            data += matchNumber.value + "."; //number
            data += allianceColor.value + "."; //string: "red" or "blue"
            data += robotPresent.value + "."; //string: "Yes" or "No"
            data += exitedTarmac.value + "."; //string: "Yes" or "No"
            data += (document.getElementById("zone_display").innerHTML.replace('Balls Selected:', '')).replaceAll(" Ball ", '/').replaceAll(",", "") + ".";//string: "/#"
            data += auton_high_scored + "."; //integer
            data += auton_low_scored + "."; //integer
            data += teleop_high_scored + "."; //integer
            data += teleop_low_scored + "."; //integer
            data += boolToChar(tarmac) + "."; //char: "t" or "f"
            data += boolToChar(launchpad) + "."; //char: "t" or "f"
            data += boolToChar(other) + "."; //char: "t" or "f"
            data += climbLevel() + "."; //string: "none" - did not attempt, "attempted", "low", "middle", "high", "traversal", "" - no input
            data += boolToChar(foul_object) + "."; //char: "t" or "f"
            data += boolToChar(tech_foul_object) + "."; //char: "t" or "f"
            data += boolToChar(yellow_object) + "."; //char: "t" or "f"
            data += boolToChar(red_object) + "."; //char: "t" or "f"
            data += opposing_high_scored + "."; //integer 
            data += opposing_low_scored + "."; //integer 
            data += boolToChar(crashing_object) + "."; //char: "t" or "f"
            data += boolToChar(drivetrain_object) + "."; //char: "t" or "f"
            data += boolToChar(defense_object) + "."; //char: "t" or "f"
            //document.getElementById("display").innerHTML = data; 
            var count = 0;
            for (let i = 0; i < data.length; i++) {
                if (data.charAt(i) == '.') {
                    count++;
                }
                if (count == 24) {
                    generateQRCode(data.substring(0, i) + ",");
                    break;
                }
            }
        };

        function climbLevel() {
            if (none.disabled) {
                return "none";
            } else if (attempted.disabled) {
                return "attempted";
            } else if (low.disabled) {
                return "low";
            } else if (middle.disabled) {
                return "middle";
            } else if (high.disabled) {
                return "high";
            } else if (traversal.disabled) {
                return "traversal";
            } else {
                return "";
            }
        }

        function removeZone(str) {
            document.getElementById("zone_display").innerHTML = document.getElementById("zone_display").innerHTML.replace(str, '');
        }
        function boolToChar(object) {
            if (object.disabled) {
                return 't';
            } else {
                return 'f';
            }
        }

        function generateQRCode() {
            str = ""
            var count = 0;
            for (let i = 0; i < data.length; i++) {
                if (data.charAt(i) == '.') {
                    count++;
                }
                if (count == 24) {
                    str = data.substring(0, i) + ",";
                    break;
                }
            }
            console.log(str);
            //https://github.com/davidshimjs/qrcodejs/blob/master/README.md
            new QRCode(document.getElementById("display"), str);
        };

        document.getElementById("copy").addEventListener("click", function () {
            gather();
            document.getElementById("display").innerHTML = data;
            if (document.queryCommandSupported && document.queryCommandSupported("copy")) {
                var textarea = document.createElement("textarea");
                textarea.textContent = data;
                textarea.style.position = "fixed";  // Prevent scrolling to bottom of page in Microsoft Edge.
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    return document.execCommand("copy");  // Security exception may be thrown by some browsers.
                }
                catch (ex) {
                    console.warn("Copy to clipboard failed.", ex);
                    return prompt("Copy to clipboard: Ctrl+C, Enter", text);
                }
                finally {
                    document.body.removeChild(textarea);
                }
            }
        });
    </script>

</body>

</html>